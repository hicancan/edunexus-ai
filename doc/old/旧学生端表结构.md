**学生端表结构**

**学生端功能完整数据库表结构总结**

此表结构以接口文档为prompt，生成的表结构，只是参考，不是最终实现

**🗄️ 用户认证相关表**

**1. 用户表 (users)**

  --------------- --------------- ----------------------- -------------------
  字段名          类型            说明                    约束

  id              BIGINT          用户ID                  PRIMARY KEY
                                                          AUTO_INCREMENT

  username        VARCHAR(50)     用户名                  UNIQUE, NOT NULL

  password        VARCHAR(100)    密码                    NOT NULL

  email           VARCHAR(100)    邮箱                    NULL

  phone           VARCHAR(20)     手机号                  NULL

  role            VARCHAR(20)     角色：student/teacher   NOT NULL

  created_at      DATETIME        创建时间                DEFAULT
                                                          CURRENT_TIMESTAMP

  updated_at      DATETIME        更新时间                DEFAULT
                                                          CURRENT_TIMESTAMP
                                                          ON UPDATE

  is_active       TINYINT(1)      是否启用                DEFAULT 1
  --------------- --------------- ----------------------- -------------------

**💬 AI问答相关表**

**2. 问答会话表 (chat_sessions)**

  --------------- --------------- --------------- -------------------
  字段名          类型            说明            约束

  session_id      VARCHAR(64)     会话ID          PRIMARY KEY

  student_id      BIGINT          学生ID          FOREIGN KEY →
                                                  users.id

  title           VARCHAR(100)    会话标题        NOT NULL

  created_at      DATETIME        创建时间        DEFAULT
                                                  CURRENT_TIMESTAMP

  updated_at      DATETIME        更新时间        DEFAULT
                                                  CURRENT_TIMESTAMP
                                                  ON UPDATE

  is_deleted      TINYINT(1)      软删除标记      DEFAULT 0
  --------------- --------------- --------------- -------------------

**3. 问答消息表 (chat_messages)**

  --------------- ---------------- ---------------- --------------------------
  字段名          类型             说明             约束

  message_id      BIGINT           消息ID           PRIMARY KEY AUTO_INCREMENT

  session_id      VARCHAR(64)      会话ID           FOREIGN KEY →
                                                    chat_sessions.session_id

  role            ENUM(\'user\',   消息角色         NOT NULL
                  \'ai\')                           

  content         TEXT             消息内容         NOT NULL

  sources         JSON             知识库来源引用   NULL

  timestamp       DATETIME         消息时间         DEFAULT CURRENT_TIMESTAMP

  token_usage     INT              Token消耗量      DEFAULT 0
  --------------- ---------------- ---------------- --------------------------

**📝 题目与练习相关表**

**4. 题目表 (questions)**

  ------------------ --------------- --------------- -------------------
  字段名             类型            说明            约束

  question_id        VARCHAR(64)     题目ID          PRIMARY KEY

  subject            VARCHAR(50)     科目            NOT NULL

  type               VARCHAR(20)     题型            NOT NULL

  difficulty         VARCHAR(10)     难度            NOT NULL

  content            TEXT            题目内容        NOT NULL

  options            JSON            选项列表        NULL

  correct_answer     VARCHAR(500)    正确答案        NOT NULL

  analysis           TEXT            题目解析        NULL

  knowledge_points   JSON            知识点数组      NULL

  score              INT             题目分值        DEFAULT 5

  source             VARCHAR(20)     题目来源        NOT NULL

  session_id         VARCHAR(64)     AI出题会话ID    NULL

  created_by         BIGINT          创建者ID        FOREIGN KEY →
                                                     users.id

  created_at         DATETIME        创建时间        DEFAULT
                                                     CURRENT_TIMESTAMP

  updated_at         DATETIME        更新时间        DEFAULT
                                                     CURRENT_TIMESTAMP
                                                     ON UPDATE

  is_active          TINYINT(1)      是否启用        DEFAULT 1
  ------------------ --------------- --------------- -------------------

**5. 答题记录表 (exercise_records)**

  ----------------- --------------- --------------- -------------------
  字段名            类型            说明            约束

  record_id         VARCHAR(64)     记录ID          PRIMARY KEY

  student_id        BIGINT          学生ID          FOREIGN KEY →
                                                    users.id

  session_id        VARCHAR(64)     AI会话ID        NULL

  submit_time       DATETIME        提交时间        DEFAULT
                                                    CURRENT_TIMESTAMP

  total_score       INT             总分            DEFAULT 0

  total_questions   INT             总题数          NOT NULL

  correct_count     INT             正确题数        DEFAULT 0

  time_spent        INT             总耗时(秒)      DEFAULT 0

  subject           VARCHAR(50)     科目            NULL

  answers_detail    JSON            答题详情        NOT NULL
  ----------------- --------------- --------------- -------------------

**6. 错题本表 (wrong_questions)**

  ----------------- --------------- --------------- -----------------------
  字段名            类型            说明            约束

  id                BIGINT          主键ID          PRIMARY KEY
                                                    AUTO_INCREMENT

  student_id        BIGINT          学生ID          FOREIGN KEY → users.id

  question_id       VARCHAR(64)     题目ID          FOREIGN KEY →
                                                    questions.question_id

  wrong_count       INT             错误次数        DEFAULT 1

  last_wrong_time   DATETIME        最后错误时间    DEFAULT
                                                    CURRENT_TIMESTAMP

  is_removed        TINYINT(1)      是否已移除      DEFAULT 0
  ----------------- --------------- --------------- -----------------------

**🤖 AI出题相关表**

**7. AI出题会话表 (ai_question_sessions)**

  ---------------- --------------- --------------- -------------------
  字段名           类型            说明            约束

  session_id       VARCHAR(64)     会话ID          PRIMARY KEY

  student_id       BIGINT          学生ID          FOREIGN KEY →
                                                   users.id

  subject          VARCHAR(50)     科目            NOT NULL

  question_count   INT             题目数量        NOT NULL

  difficulty       VARCHAR(10)     难度            NULL

  generated_at     DATETIME        生成时间        DEFAULT
                                                   CURRENT_TIMESTAMP

  completed        TINYINT(1)      是否已完成      DEFAULT 0
  ---------------- --------------- --------------- -------------------

**🔗 表关系图**

  --------------------------------------------------------------
  Plain Text\
  users\
  │\
  ├── chat_sessions (student_id)\
  │ └── chat_messages (session_id)\
  │\
  ├── questions (created_by)\
  │ └── wrong_questions (question_id)\
  │\
  ├── exercise_records (student_id)\
  │\
  └── ai_question_sessions (student_id)\
  └── questions (session_id)

  --------------------------------------------------------------

**📊 字段枚举值说明**

**用户角色 (users.role)**

student - 学生

teacher - 教师

**题目类型 (questions.type)**

single_choice - 单选题

multiple_choice - 多选题

fill_blank - 填空题

short_answer - 简答题

**题目难度 (questions.difficulty)**

easy - 简单

medium - 中等

hard - 困难

**题目来源 (questions.source)**

teacher - 教师创建

ai - AI生成

**消息角色 (chat_messages.role)**

user - 用户消息

ai - AI回复

**💡 设计特点总结**

**统一用户体系**：所有用户都在同一张表，通过role区分

**JSON灵活存储**：选项、知识点、答题详情等使用JSON类型，便于扩展

**简化表结构**：去除了答题详情表，将详情存储在答题记录表的JSON字段中

**软删除设计**：重要数据使用软删除，保留历史记录

**来源追踪**：清晰记录题目、会话的创建来源

**关系清晰**：通过外键约束保证数据完整性

**扩展性强**：表结构设计考虑未来功能扩展

**🎯 核心表说明**

**答题详情JSON结构 (exercise_records.answers_detail)**

  --------------------------------------------------------------
  JSON\
  \[\
  {\
  \"questionId\": \"q_001\",\
  \"userAnswer\": \"A\",\
  \"isCorrect\": true,\
  \"score\": 5,\
  \"timeSpent\": 45,\
  \"teacherSuggestion\": \"注意计算顺序\"\
  },\
  {\
  \"questionId\": \"q_002\",\
  \"userAnswer\": \"A,C\",\
  \"isCorrect\": false,\
  \"score\": 0,\
  \"timeSpent\": 68,\
  \"teacherSuggestion\": null\
  }\
  \]

  --------------------------------------------------------------

这套表结构完整支持学生端的所有功能需求，包括AI问答、做题练习、错题管理、教师建议、AI出题等核心业务场景。
