# EduNexus AI 开发约束与代码规范

## 1. 文档目标
定义工程落地规则，确保多人协作下代码风格、目录结构、接口行为保持一致。

## 2. 推荐技术栈（MVP 顶配但可控）

1. 前端：Vue 3 + TypeScript + Vite + Pinia + Vue Router + Axios
2. 业务后端：Spring Boot 3.x + Java 21 + MyBatis-Plus + Flyway
3. AI 服务：FastAPI + Python 3.12 + LangChain/LangGraph（可选）
4. 数据：PostgreSQL + Redis + Qdrant + MinIO
5. 容器：Docker Compose（本地）

## 3. 目录规范（建议）

```text
edunexus-ai/
  apps/
    web/
    api/
    ai-service/
  doc/
    00-SSOT-总则.md
    ...
  infra/
    docker/
    scripts/
```

## 4. 编码规范

## 4.1 命名

1. Java 类名使用 PascalCase，方法/变量使用 camelCase。
2. 数据库表名使用 snake_case，字段名使用 snake_case。
3. API 路径使用小写 + `-` 分隔，禁止混用下划线。

## 4.2 API 响应规范

统一响应结构：

```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "traceId": "trace-xxx",
  "timestamp": "2026-02-26T10:00:00Z"
}
```

## 4.3 错误码约定

- `AUTH_*`：认证错误
- `PERMISSION_*`：权限错误
- `VALIDATION_*`：参数校验错误
- `RESOURCE_*`：资源不存在/冲突
- `AI_*`：模型调用与输出错误
- `SYSTEM_*`：系统异常

## 4.4 日志规范

1. 日志必须结构化（JSON 或 key-value）。
2. 每条关键日志必须带 `traceId`。
3. 禁止打印密码、token、API key。
4. AI 调用日志至少包含 provider/model/latency/tokens。

## 5. 前端约束

1. 页面必须具备 `loading/empty/error` 三态。
2. API 调用必须集中在 `services` 层，不得在组件中散写。
3. 路由守卫必须基于角色与登录态。
4. 富文本输出（AI 回答）必须做 XSS 安全处理。

## 6. 后端约束

1. Controller 只做协议转换，不写复杂业务逻辑。
2. Service 承载业务逻辑，Repository/Mapper 仅负责数据访问。
3. 所有涉及归属的数据接口必须调用统一 `ownershipGuard`。
4. 事务边界明确：提交答案、错题入库、记录写入必须同事务。

## 7. AI 服务约束

1. Prompt 模板统一集中管理，禁止散落硬编码。
2. 模型路由必须读取环境配置，禁止代码写死 provider。
3. 解析模型输出时必须做 JSON Schema 校验（AI 出题场景）。
4. RAG 检索必须强制过滤 teacher/class 范围。

## 8. 数据库与迁移约束

1. 所有表结构变更只能通过 Flyway 迁移脚本。
2. 禁止直接手改线上表结构。
3. 索引变更需评估查询路径并记录原因。
4. 删除字段必须先完成停用期，再执行迁移删除。

## 9. 分支与提交建议

1. 分支：`feature/<module>-<short-desc>`。
2. 提交信息：`feat|fix|refactor|docs(scope): message`。
3. 每个功能分支必须能映射到需求 ID。

## 10. 最低交付要求（无妥协）

1. 需求必须在 `02-需求追踪矩阵.md` 标记并闭环。
2. API 必须与 `06-API契约-openapi.yaml` 一致。
3. 数据结构必须与 `05-数据模型与迁移规范.md` 一致。
4. 权限行为必须与 `07-鉴权与权限模型.md` 一致。
5. AI 行为必须与 `08-AI与RAG策略.md` 一致。

---
文档状态：`v1.0.0`
