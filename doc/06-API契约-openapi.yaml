openapi: 3.1.0
info:
  title: EduNexus AI API Contract
  version: 1.0.0
  description: |
    EduNexus AI MVP 接口契约（v1.2.0）。
    本文件是前端、后端、AI 服务联调与代码生成的唯一接口基线。
    所有响应均遵循 ApiResponse 包装，data 字段类型见各接口描述与 schemas 定义。
    枚举值权威定义见 04-领域模型 §5，本文件仅做引用。
    
    ## 接口 → data 类型速查
    | 接口 | data 类型 |
    |------|----------|
    | POST /auth/register | UserVO |
    | POST /auth/login | LoginData |
    | POST /auth/logout | null |
    | POST /auth/refresh | RefreshData |
    | GET /auth/me | UserVO |
    | POST /student/chat/session | ChatSessionVO |
    | GET /student/chat/sessions | PagedData<ChatSessionVO> |
    | GET /student/chat/session/{id} | ChatSessionDetailVO |
    | DELETE /student/chat/session/{id} | null |
    | POST /student/chat/session/{id}/message | ChatReplyVO |
    | GET /student/exercise/questions | PagedData<QuestionVO> |
    | POST /student/exercise/submit | ExerciseResultVO |
    | GET /student/exercise/{id}/analysis | ExerciseAnalysisVO |
    | GET /student/exercise/wrong-questions | PagedData<WrongBookEntryVO> |
    | DELETE /student/exercise/wrong-questions/{id} | null |
    | GET /student/exercise/records | PagedData<ExerciseRecordVO> |
    | POST /student/ai-questions/generate | AiQuestionGenerateResultVO |
    | GET /student/ai-questions | PagedData<AiQuestionSessionVO> |
    | POST /student/ai-questions/submit | AiQuestionResultVO |
    | GET /student/ai-questions/{id}/analysis | AiQuestionAnalysisVO |
    | POST /teacher/knowledge/documents | DocumentVO |
    | GET /teacher/knowledge/documents | DocumentVO[] |
    | DELETE /teacher/knowledge/documents/{id} | null |
    | POST /teacher/plans/generate | LessonPlanVO |
    | GET /teacher/plans | PagedData<LessonPlanVO> |
    | PUT /teacher/plans/{id} | LessonPlanVO |
    | DELETE /teacher/plans/{id} | null |
    | GET /teacher/plans/{id}/export | binary |
    | POST /teacher/plans/{id}/share | ShareResultVO |
    | GET /teacher/plans/shared/{token} | LessonPlanVO |
    | GET /teacher/students/{id}/analytics | StudentAnalyticsVO |
    | POST /teacher/suggestions | TeacherSuggestionVO |
    | GET /admin/users | PagedData<UserVO> |
    | POST /admin/users | UserVO |
    | PATCH /admin/users/{id} | UserVO |
    | GET /admin/resources | PagedData<AdminResourceVO> |
    | GET /admin/resources/{id}/download | binary |
    | GET /admin/audits | PagedData<AuditLogVO> |
    | GET /admin/dashboard/metrics | DashboardMetricsVO |
servers:
  - url: /api/v1
    description: Base URL
security:
  - bearerAuth: []
tags:
  - name: Auth
  - name: Student-Chat
  - name: Student-Exercise
  - name: Student-AIQuestions
  - name: Teacher-Knowledge
  - name: Teacher-Plan
  - name: Teacher-Analytics
  - name: Admin

paths:
  /auth/register:
    post:
      tags: [Auth]
      summary: 用户注册（学生/教师）
      security: []
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '200':
          description: 注册成功。data → UserVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/login:
    post:
      tags: [Auth]
      summary: 用户登录
      security: []
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 登录成功。data → LoginData（含 accessToken、refreshToken、user）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              examples:
                success:
                  value:
                    code: 200
                    message: 登录成功
                    data:
                      accessToken: token
                      refreshToken: refresh
                      user:
                        id: 00000000-0000-0000-0000-000000000001
                        username: student01
                        role: STUDENT
                    traceId: trace-xxx
                    timestamp: '2026-02-26T10:00:00Z'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      tags: [Auth]
      summary: 退出登录
      operationId: logout
      responses:
        '200':
          description: 退出成功。data → null
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /auth/refresh:
    post:
      tags: [Auth]
      summary: 刷新 Access Token
      security: []
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: 刷新成功。data → RefreshData
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/me:
    get:
      tags: [Auth]
      summary: 获取当前用户信息
      operationId: getMe
      responses:
        '200':
          description: 获取成功。data → UserVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /student/chat/session:
    post:
      tags: [Student-Chat]
      summary: 新建聊天会话
      operationId: createChatSession
      responses:
        '201':
          description: 创建成功。data → ChatSessionVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/chat/sessions:
    get:
      tags: [Student-Chat]
      summary: 获取聊天会话列表
      operationId: listChatSessions
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: 获取成功。data → PagedData，content 元素为 ChatSessionVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/chat/session/{sessionId}:
    get:
      tags: [Student-Chat]
      summary: 获取会话详情
      operationId: getChatSessionDetail
      parameters:
        - $ref: '#/components/parameters/SessionId'
      responses:
        '200':
          description: 获取成功。data → ChatSessionDetailVO（含 messages 列表）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [Student-Chat]
      summary: 删除会话（软删除）
      operationId: deleteChatSession
      parameters:
        - $ref: '#/components/parameters/SessionId'
      responses:
        '200':
          description: 删除成功。data → null
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '403':
          $ref: '#/components/responses/Forbidden'

  /student/chat/session/{sessionId}/message:
    post:
      tags: [Student-Chat]
      summary: 向会话发送消息（支持 SSE）
      operationId: sendChatMessage
      parameters:
        - $ref: '#/components/parameters/SessionId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatSendRequest'
      responses:
        '200':
          description: 响应成功。data → ChatReplyVO（JSON）或 SSE 流（text/event-stream）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
            text/event-stream:
              schema:
                type: string
                example: |
                  data: {"delta":"力的公式是 F=ma","citations":[{"title":"physics_ch3.pdf","score":0.92}]}
                  data: [DONE]
        '403':
          $ref: '#/components/responses/Forbidden'

  /student/exercise/questions:
    get:
      tags: [Student-Exercise]
      summary: 获取练习题列表
      operationId: listExerciseQuestions
      parameters:
        - name: subject
          in: query
          schema:
            type: string
        - name: difficulty
          in: query
          schema:
            type: string
            enum: [EASY, MEDIUM, HARD]
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: 获取成功。data → PagedData，content 元素为 QuestionVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/exercise/submit:
    post:
      tags: [Student-Exercise]
      summary: 提交练习答案并自动判分
      operationId: submitExerciseAnswers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExerciseSubmitRequest'
      responses:
        '200':
          description: 提交成功。data → ExerciseResultVO（含逐题判分结果）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/exercise/{recordId}/analysis:
    get:
      tags: [Student-Exercise]
      summary: 查看练习解析
      operationId: getExerciseAnalysis
      parameters:
        - $ref: '#/components/parameters/RecordId'
      responses:
        '200':
          description: 查询成功。data → ExerciseAnalysisVO（含逐题解析与教师建议）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/exercise/wrong-questions:
    get:
      tags: [Student-Exercise]
      summary: 获取错题本
      operationId: listWrongQuestions
      parameters:
        - name: subject
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [ACTIVE, MASTERED]
            default: ACTIVE
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: 查询成功。data → PagedData，content 元素为 WrongBookEntryVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/exercise/wrong-questions/{questionId}:
    delete:
      tags: [Student-Exercise]
      summary: 从错题本移除（标记已掌握）
      operationId: removeWrongQuestion
      parameters:
        - $ref: '#/components/parameters/QuestionId'
      responses:
        '200':
          description: 移除成功。data → null
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/exercise/records:
    get:
      tags: [Student-Exercise]
      summary: 获取做题记录
      operationId: listExerciseRecords
      parameters:
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: 查询成功。data → PagedData，content 元素为 ExerciseRecordVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/ai-questions/generate:
    post:
      tags: [Student-AIQuestions]
      summary: 生成 AI 个性化题目
      operationId: generateAiQuestions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AiQuestionGenerateRequest'
      responses:
        '200':
          description: 生成成功。data → AiQuestionGenerateResultVO（含生成题目列表）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/ai-questions:
    get:
      tags: [Student-AIQuestions]
      summary: 获取 AI 出题历史
      operationId: listAiQuestionSessions
      parameters:
        - name: subject
          in: query
          schema:
            type: string
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: 查询成功。data → PagedData，content 元素为 AiQuestionSessionVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/ai-questions/submit:
    post:
      tags: [Student-AIQuestions]
      summary: 提交 AI 题目答案
      operationId: submitAiQuestions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AiQuestionSubmitRequest'
      responses:
        '200':
          description: 提交成功。data → AiQuestionResultVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /student/ai-questions/{recordId}/analysis:
    get:
      tags: [Student-AIQuestions]
      summary: 获取 AI 题目解析
      operationId: getAiQuestionAnalysis
      parameters:
        - $ref: '#/components/parameters/RecordId'
      responses:
        '200':
          description: 查询成功。data → AiQuestionAnalysisVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /teacher/knowledge/documents:
    post:
      tags: [Teacher-Knowledge]
      summary: 上传知识库文档
      operationId: uploadKnowledgeDocument
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '202':
          description: 已接收并进入处理。data → DocumentVO（status=UPLOADING）
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    get:
      tags: [Teacher-Knowledge]
      summary: 获取知识库文档列表
      operationId: listKnowledgeDocuments
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [UPLOADING, PARSING, EMBEDDING, READY, FAILED]
      responses:
        '200':
          description: 查询成功。data → DocumentVO 数组
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /teacher/knowledge/documents/{documentId}:
    delete:
      tags: [Teacher-Knowledge]
      summary: 删除知识库文档并级联删除向量
      operationId: deleteKnowledgeDocument
      parameters:
        - $ref: '#/components/parameters/DocumentId'
      responses:
        '200':
          description: 删除成功。data → null
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /teacher/plans/generate:
    post:
      tags: [Teacher-Plan]
      summary: 生成 AI 教案
      operationId: generateLessonPlan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlanGenerateRequest'
      responses:
        '200':
          description: 生成成功。data → LessonPlanVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /teacher/plans:
    get:
      tags: [Teacher-Plan]
      summary: 获取教案列表
      operationId: listLessonPlans
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: 查询成功。data → PagedData，content 元素为 LessonPlanVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /teacher/plans/{planId}:
    put:
      tags: [Teacher-Plan]
      summary: 更新教案
      operationId: updateLessonPlan
      parameters:
        - $ref: '#/components/parameters/PlanId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlanUpdateRequest'
      responses:
        '200':
          description: 更新成功。data → LessonPlanVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    delete:
      tags: [Teacher-Plan]
      summary: 删除教案
      operationId: deleteLessonPlan
      parameters:
        - $ref: '#/components/parameters/PlanId'
      responses:
        '200':
          description: 删除成功。data → null
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /teacher/plans/{planId}/export:
    get:
      tags: [Teacher-Plan]
      summary: 导出教案
      operationId: exportLessonPlan
      parameters:
        - $ref: '#/components/parameters/PlanId'
        - name: format
          in: query
          required: true
          schema:
            type: string
            enum: [md, pdf]
      responses:
        '200':
          description: 导出成功
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /teacher/plans/{planId}/share:
    post:
      tags: [Teacher-Plan]
      summary: 生成教案分享链接
      operationId: shareLessonPlan
      parameters:
        - $ref: '#/components/parameters/PlanId'
      responses:
        '200':
          description: 生成成功。data → ShareResultVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                code: 200
                message: success
                data:
                  planId: 00000000-0000-0000-0000-000000000100
                  shareToken: abcdef123456
                  shareUrl: /api/v1/teacher/plans/shared/abcdef123456
                traceId: trace-xxx
                timestamp: '2026-02-26T10:00:00Z'

  /teacher/plans/shared/{shareToken}:
    get:
      tags: [Teacher-Plan]
      summary: 通过分享令牌访问教案
      security: []
      operationId: getSharedLessonPlan
      parameters:
        - name: shareToken
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 查询成功。data → LessonPlanVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /teacher/students/{studentId}/analytics:
    get:
      tags: [Teacher-Analytics]
      summary: 获取学生学情分析
      operationId: getStudentAnalytics
      parameters:
        - $ref: '#/components/parameters/StudentId'
      responses:
        '200':
          description: 查询成功。data → StudentAnalyticsVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /teacher/suggestions:
    post:
      tags: [Teacher-Analytics]
      summary: 创建教师建议
      operationId: createTeacherSuggestion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeacherSuggestionRequest'
      responses:
        '200':
          description: 创建成功。data → TeacherSuggestionVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /admin/users:
    get:
      tags: [Admin]
      summary: 获取用户列表
      operationId: listUsers
      parameters:
        - name: role
          in: query
          schema:
            type: string
            enum: [STUDENT, TEACHER, ADMIN]
        - name: status
          in: query
          schema:
            type: string
            enum: [ACTIVE, DISABLED]
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: 查询成功。data → PagedData，content 元素为 UserVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
    post:
      tags: [Admin]
      summary: 创建用户
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserCreateRequest'
      responses:
        '201':
          description: 创建成功。data → UserVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /admin/users/{userId}:
    patch:
      tags: [Admin]
      summary: 更新用户状态或角色
      operationId: patchUser
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserPatchRequest'
      responses:
        '200':
          description: 更新成功。data → UserVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /admin/resources:
    get:
      tags: [Admin]
      summary: 获取资源列表（教案/题库/文档）
      operationId: listResources
      parameters:
        - name: resourceType
          in: query
          schema:
            type: string
            enum: [LESSON_PLAN, QUESTION, DOCUMENT]
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: 查询成功。data → PagedData，content 元素为 AdminResourceVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /admin/resources/{resourceId}/download:
    get:
      tags: [Admin]
      summary: 下载资源
      operationId: downloadResource
      parameters:
        - $ref: '#/components/parameters/ResourceId'
      responses:
        '200':
          description: 下载成功
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /admin/audits:
    get:
      tags: [Admin]
      summary: 获取审计日志
      operationId: listAudits
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/Size'
      responses:
        '200':
          description: 查询成功。data → PagedData，content 元素为 AuditLogVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /admin/dashboard/metrics:
    get:
      tags: [Admin]
      summary: 平台指标看板
      operationId: getAdminDashboardMetrics
      responses:
        '200':
          description: 查询成功。data → DashboardMetricsVO
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    Page:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
    Size:
      name: size
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
    SessionId:
      name: sessionId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    RecordId:
      name: recordId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    QuestionId:
      name: questionId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    DocumentId:
      name: documentId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    PlanId:
      name: planId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    StudentId:
      name: studentId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    UserId:
      name: userId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    ResourceId:
      name: resourceId
      in: path
      required: true
      schema:
        type: string
        format: uuid

  responses:
    BadRequest:
      description: 请求参数错误
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            code: 400
            message: 参数错误
            data: null
            traceId: trace-xxx
            timestamp: '2026-02-26T10:00:00Z'
    Unauthorized:
      description: 未认证或 token 失效
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            code: 401
            message: 未认证
            data: null
            traceId: trace-xxx
            timestamp: '2026-02-26T10:00:00Z'
    Forbidden:
      description: 无权限
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            code: 403
            message: 无权限访问
            data: null
            traceId: trace-xxx
            timestamp: '2026-02-26T10:00:00Z'
    NotFound:
      description: 资源不存在
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
          example:
            code: 404
            message: 资源不存在
            data: null
            traceId: trace-xxx
            timestamp: '2026-02-26T10:00:00Z'

  schemas:
    # ─────────────────────────────────────────
    # 通用包装
    # ─────────────────────────────────────────
    ApiResponse:
      type: object
      required: [code, message, timestamp]
      description: 统一响应包装。具体接口通过 allOf 指定 data 类型。
      properties:
        code:
          type: integer
        message:
          type: string
        data:
          description: 具体业务数据（由各接口 Schema 定义）
        traceId:
          type: string
        timestamp:
          type: string
          format: date-time

    PagedData:
      type: object
      description: 分页包装，所有分页接口的 data 字段共用此结构。
      required: [content, page, size, totalElements, totalPages]
      properties:
        content:
          type: array
          description: 当前页数据列表
          items: {}
        page:
          type: integer
          description: 当前页码（从 1 开始）
        size:
          type: integer
          description: 每页大小
        totalElements:
          type: integer
          description: 总记录数
          format: int64
        totalPages:
          type: integer
          description: 总页数

    # ─────────────────────────────────────────
    # 响应数据对象（VO）
    # ─────────────────────────────────────────
    UserVO:
      type: object
      description: 用户信息（对外展示）
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        role:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [STUDENT, TEACHER, ADMIN]
        status:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [ACTIVE, DISABLED]
        email:
          type: string
        phone:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    LoginData:
      type: object
      description: 登录成功返回
      required: [accessToken, refreshToken, user]
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        user:
          $ref: '#/components/schemas/UserVO'

    RefreshData:
      type: object
      description: 刷新 token 返回
      required: [accessToken, refreshToken]
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string

    ChatSessionVO:
      type: object
      description: 聊天会话
      properties:
        id:
          type: string
          format: uuid
        studentId:
          type: string
          format: uuid
        title:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ChatSessionDetailVO:
      type: object
      description: 聊天会话详情（含消息列表）
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        createdAt:
          type: string
          format: date-time
        messages:
          type: array
          items:
            $ref: '#/components/schemas/ChatMessageVO'

    ChatMessageVO:
      type: object
      description: 聊天消息
      properties:
        id:
          type: string
          format: uuid
        role:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [USER, ASSISTANT]
        content:
          type: string
        citations:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/CitationVO'
        tokenUsage:
          type: integer
        createdAt:
          type: string
          format: date-time

    CitationVO:
      type: object
      description: AI 回答引用来源
      properties:
        documentId:
          type: string
          format: uuid
        filename:
          type: string
        chunkIndex:
          type: integer
        content:
          type: string
          description: 引用片段文本
        score:
          type: number
          format: float
          description: 相似度得分

    ChatReplyVO:
      type: object
      description: 发送消息后的完整回复
      properties:
        userMessage:
          $ref: '#/components/schemas/ChatMessageVO'
        assistantMessage:
          $ref: '#/components/schemas/ChatMessageVO'

    QuestionVO:
      type: object
      description: 题目
      properties:
        id:
          type: string
          format: uuid
        subject:
          type: string
        questionType:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [SINGLE_CHOICE, MULTIPLE_CHOICE, TRUE_FALSE, SHORT_ANSWER]
        difficulty:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [EASY, MEDIUM, HARD]
        content:
          type: string
        options:
          type: object
          nullable: true
          additionalProperties:
            type: string
        correctAnswer:
          type: string
        analysis:
          type: string
          nullable: true
        knowledgePoints:
          type: array
          nullable: true
          items:
            type: string
        score:
          type: integer
        source:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [MANUAL, AI_GENERATED]
        createdAt:
          type: string
          format: date-time

    ExerciseResultVO:
      type: object
      description: 做题提交结果
      properties:
        recordId:
          type: string
          format: uuid
        totalQuestions:
          type: integer
        correctCount:
          type: integer
        totalScore:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/ExerciseResultItemVO'

    ExerciseResultItemVO:
      type: object
      description: 做题结果明细
      properties:
        questionId:
          type: string
          format: uuid
        userAnswer:
          type: string
        correctAnswer:
          type: string
        isCorrect:
          type: boolean
        score:
          type: integer

    ExerciseAnalysisVO:
      type: object
      description: 做题解析
      properties:
        recordId:
          type: string
          format: uuid
        items:
          type: array
          items:
            $ref: '#/components/schemas/ExerciseAnalysisItemVO'

    ExerciseAnalysisItemVO:
      type: object
      description: 逐题解析
      properties:
        questionId:
          type: string
          format: uuid
        content:
          type: string
          description: 题干
        userAnswer:
          type: string
        correctAnswer:
          type: string
        isCorrect:
          type: boolean
        analysis:
          type: string
          nullable: true
        knowledgePoints:
          type: array
          nullable: true
          items:
            type: string
        teacherSuggestion:
          type: string
          nullable: true
          description: 教师建议（若存在）

    WrongBookEntryVO:
      type: object
      description: 错题本条目
      properties:
        id:
          type: string
          format: uuid
        questionId:
          type: string
          format: uuid
        question:
          $ref: '#/components/schemas/QuestionVO'
        wrongCount:
          type: integer
        lastWrongTime:
          type: string
          format: date-time
        status:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [ACTIVE, MASTERED]

    ExerciseRecordVO:
      type: object
      description: 做题历史记录
      properties:
        id:
          type: string
          format: uuid
        subject:
          type: string
          nullable: true
        totalQuestions:
          type: integer
        correctCount:
          type: integer
        totalScore:
          type: integer
        timeSpent:
          type: integer
          description: 耗时（秒）
        createdAt:
          type: string
          format: date-time

    AiQuestionSessionVO:
      type: object
      description: AI 出题会话
      properties:
        id:
          type: string
          format: uuid
        subject:
          type: string
        difficulty:
          type: string
          nullable: true
          enum: [EASY, MEDIUM, HARD]
        questionCount:
          type: integer
        completed:
          type: boolean
        correctRate:
          type: number
          format: float
          nullable: true
          description: 正确率（0-100）
        score:
          type: integer
          nullable: true
        generatedAt:
          type: string
          format: date-time

    AiQuestionGenerateResultVO:
      type: object
      description: AI 出题生成结果
      properties:
        sessionId:
          type: string
          format: uuid
        questions:
          type: array
          items:
            $ref: '#/components/schemas/QuestionVO'

    AiQuestionResultVO:
      type: object
      description: AI 题提交结果
      properties:
        recordId:
          type: string
          format: uuid
        sessionId:
          type: string
          format: uuid
        totalQuestions:
          type: integer
        correctCount:
          type: integer
        totalScore:
          type: integer
        items:
          type: array
          items:
            $ref: '#/components/schemas/ExerciseResultItemVO'

    AiQuestionAnalysisVO:
      type: object
      description: AI 题解析
      properties:
        recordId:
          type: string
          format: uuid
        items:
          type: array
          items:
            $ref: '#/components/schemas/ExerciseAnalysisItemVO'

    DocumentVO:
      type: object
      description: 知识库文档
      properties:
        id:
          type: string
          format: uuid
        filename:
          type: string
        fileType:
          type: string
        fileSize:
          type: integer
          format: int64
        status:
          type: string
          description: 状态机定义见 04-领域模型 §3.1
          enum: [UPLOADING, PARSING, EMBEDDING, READY, FAILED]
        errorMessage:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    LessonPlanVO:
      type: object
      description: 教案
      properties:
        id:
          type: string
          format: uuid
        topic:
          type: string
        gradeLevel:
          type: string
        durationMins:
          type: integer
        contentMd:
          type: string
          description: Markdown 教案内容
        isShared:
          type: boolean
        shareToken:
          type: string
          nullable: true
        sharedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    ShareResultVO:
      type: object
      description: 教案分享结果
      properties:
        planId:
          type: string
          format: uuid
        shareToken:
          type: string
        shareUrl:
          type: string

    StudentAnalyticsVO:
      type: object
      description: 学生学情分析
      properties:
        studentId:
          type: string
          format: uuid
        username:
          type: string
        totalExercises:
          type: integer
          description: 总做题次数
        totalQuestions:
          type: integer
          description: 总题目数
        correctCount:
          type: integer
          description: 总正确数
        averageScore:
          type: number
          format: float
          description: 平均分
        wrongBookCount:
          type: integer
          description: 当前错题本题数
        topWeakPoints:
          type: array
          description: 高频错题知识点
          items:
            type: object
            properties:
              knowledgePoint:
                type: string
              wrongCount:
                type: integer

    TeacherSuggestionVO:
      type: object
      description: 教师建议
      properties:
        id:
          type: string
          format: uuid
        teacherId:
          type: string
          format: uuid
        studentId:
          type: string
          format: uuid
        questionId:
          type: string
          format: uuid
          nullable: true
        knowledgePoint:
          type: string
          nullable: true
        suggestion:
          type: string
        createdAt:
          type: string
          format: date-time

    AuditLogVO:
      type: object
      description: 审计日志
      properties:
        id:
          type: string
          format: uuid
        actorId:
          type: string
          format: uuid
        actorRole:
          type: string
        action:
          type: string
        resourceType:
          type: string
        resourceId:
          type: string
        detail:
          type: object
          nullable: true
        ip:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time

    DashboardMetricsVO:
      type: object
      description: 管理端看板指标
      properties:
        totalUsers:
          type: integer
        totalStudents:
          type: integer
        totalTeachers:
          type: integer
        totalChatSessions:
          type: integer
        totalExerciseRecords:
          type: integer
        totalDocuments:
          type: integer
        totalKnowledgeChunks:
          type: integer
        totalLessonPlans:
          type: integer

    AdminResourceVO:
      type: object
      description: 管理端资源列表项
      properties:
        resourceId:
          type: string
          format: uuid
        resourceType:
          type: string
          enum: [LESSON_PLAN, QUESTION, DOCUMENT]
        title:
          type: string
          description: 资源标题（教案 topic / 题目 content 摘要 / 文档 filename）
        creatorId:
          type: string
          format: uuid
        creatorUsername:
          type: string
        createdAt:
          type: string
          format: date-time

    # ─────────────────────────────────────────
    # 请求对象
    # ─────────────────────────────────────────
    RegisterRequest:
      type: object
      required: [username, password, role]
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 50
        password:
          type: string
          minLength: 8
          maxLength: 64
        email:
          type: string
          format: email
        phone:
          type: string
          maxLength: 20
        role:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [STUDENT, TEACHER]

    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
        password:
          type: string

    RefreshRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string

    ChatSendRequest:
      type: object
      required: [message]
      properties:
        message:
          type: string
          minLength: 1
          maxLength: 4000

    ExerciseSubmitRequest:
      type: object
      required: [answers]
      properties:
        answers:
          type: array
          minItems: 1
          items:
            type: object
            required: [questionId, userAnswer]
            properties:
              questionId:
                type: string
                format: uuid
              userAnswer:
                type: string

    AiQuestionGenerateRequest:
      type: object
      required: [count, subject]
      properties:
        count:
          type: integer
          minimum: 1
          maximum: 20
        subject:
          type: string
        difficulty:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [EASY, MEDIUM, HARD]
        conceptTags:
          type: array
          items:
            type: string

    AiQuestionSubmitRequest:
      type: object
      required: [sessionId, answers]
      properties:
        sessionId:
          type: string
          format: uuid
        answers:
          type: array
          minItems: 1
          items:
            type: object
            required: [questionId, userAnswer]
            properties:
              questionId:
                type: string
                format: uuid
              userAnswer:
                type: string

    PlanGenerateRequest:
      type: object
      required: [topic, gradeLevel, durationMins]
      properties:
        topic:
          type: string
        gradeLevel:
          type: string
        durationMins:
          type: integer
          minimum: 10
          maximum: 180

    PlanUpdateRequest:
      type: object
      required: [content]
      properties:
        content:
          type: string

    TeacherSuggestionRequest:
      type: object
      required: [studentId, suggestion]
      properties:
        studentId:
          type: string
          format: uuid
        questionId:
          type: string
          format: uuid
        knowledgePoint:
          type: string
        suggestion:
          type: string
          minLength: 1
          maxLength: 2000

    AdminUserCreateRequest:
      type: object
      required: [username, password, role]
      properties:
        username:
          type: string
        password:
          type: string
        role:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [STUDENT, TEACHER, ADMIN]
        email:
          type: string
          format: email
        phone:
          type: string

    AdminUserPatchRequest:
      type: object
      properties:
        role:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [STUDENT, TEACHER, ADMIN]
        status:
          type: string
          description: 枚举定义见 04-领域模型 §5
          enum: [ACTIVE, DISABLED]
