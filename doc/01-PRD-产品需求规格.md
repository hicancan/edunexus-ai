# EduNexus AI 产品需求规格（PRD）

## 1. 文档定位
本 PRD 以 `doc/old/` 四份历史文档为需求输入基线，面向“可落地、可验收、可演示”的 MVP。

原则：

1. 范围可控，但范围内需求必须全部实现。
2. 每条需求必须有唯一 `需求ID`。
3. 需求描述必须可直接转化为页面、接口和数据结构。

## 2. 产品目标
EduNexus AI 是面向高校实训场景的 AI 学习平台，覆盖学生端、教师端、管理端，形成“学-练-评-教-管”闭环。

核心目标：

1. 学生端实现 AI 问答、做题纠错、错题管理、个性化出题。
2. 教师端实现知识库上传、教案生成、学情分析、建议反馈。
3. 管理端实现用户治理、资源治理、可视化看板。

## 3. 角色定义

- 学生（STUDENT）：学习、练习、纠错。
- 教师（TEACHER）：内容注入、教学辅助、学情反馈。
- 管理员（ADMIN）：用户/资源管理和全局看板。

## 4. MVP 范围

### 4.1 In Scope（本期必须完成）

- 账号注册/登录/退出/鉴权。
- 学生聊天会话管理 + RAG 问答。
- 练习题获取、提交、自动批改、解析。
- 错题本自动收录、查询、移除（已掌握）。
- AI 个性化出题、提交、解析、历史记录。
- 教师知识库上传与处理状态跟踪。
- 教师教案生成、编辑、保存、导出。
- 教师学情分析与建议管理。
- 管理端用户管理、资源管理、指标看板。

### 4.2 Out of Scope（本期不做）

- 原生 iOS/Android 应用。
- 多组织 SaaS 计费体系。
- 多地域多活容灾体系。

## 5. 功能需求（带需求 ID）

## 5.1 认证与账号（AUTH）

| 需求ID | 需求描述 | 验收标准 |
|---|---|---|
| R-AUTH-01 | 支持学生/教师账号注册 | `POST /auth/register` 可创建账号；重复用户名报错 |
| R-AUTH-02 | 注册字段支持 username/password/role，email/phone 可选 | 字段校验符合契约；role 仅允许 STUDENT/TEACHER |
| R-AUTH-03 | 支持账号登录并返回 JWT | `POST /auth/login` 返回 access token、用户信息 |
| R-AUTH-04 | 支持退出登录 | `POST /auth/logout` 后旧 token 不再可用（或加入黑名单） |
| R-AUTH-05 | 所有受保护接口必须校验 JWT | 无 token 或无效 token 返回 401 |
| R-AUTH-06 | 后端从 token 解析用户身份 | 学生侧接口不接受前端传 username 作为权限依据 |
| R-AUTH-07 | 支持获取当前登录用户信息 | `GET /auth/me` 返回 id/username/role/status |

## 5.2 学生端 AI 聊天（CHAT）

| 需求ID | 需求描述 | 验收标准 |
|---|---|---|
| R-CHAT-01 | 支持创建聊天会话 | 创建成功返回 `sessionId` |
| R-CHAT-02 | 支持分页查询会话列表 | 可按 page/size 查询历史会话 |
| R-CHAT-03 | 支持查看会话详情与消息列表 | 返回完整 message 序列与来源引用 |
| R-CHAT-04 | 支持向指定会话发送消息并获得 AI 回复 | 发送成功；返回内容含 `sources/citations` |
| R-CHAT-05 | 支持删除会话（软删除） | 删除后列表默认不可见，数据可追溯 |
| R-CHAT-06 | 会话标题自动生成 | 规则：取首条用户消息前 20 字，无消息显示“新建对话” |
| R-CHAT-07 | 会话访问必须做归属校验 | 非会话 owner 访问/删除返回 403 |
| R-CHAT-08 | 问答必须使用 RAG | 回答引用私有知识库片段；无命中时明确提示不确定 |
| R-CHAT-09 | 复杂度驱动模型路由 | 简单问答/复杂推理走不同模型配置 |

## 5.3 学生端做题与纠错（EX）

| 需求ID | 需求描述 | 验收标准 |
|---|---|---|
| R-EX-01 | 支持按学科/难度/分页获取题目 | `GET /student/exercise/questions` 支持查询参数 |
| R-EX-02 | 支持批量提交答案 | `POST /student/exercise/submit` 接收 answers 数组 |
| R-EX-03 | 提交后自动判分与汇总 | 返回逐题正确性、总分、正确数、总题数 |
| R-EX-04 | 支持按 recordId 查看解析 | 返回题目、答案、解析、知识点 |
| R-EX-05 | 错题自动入错题本 | 提交后错误题自动写入 wrong_book |
| R-EX-06 | 支持错题本查询 | 可按 subject/status 分页查询 |
| R-EX-07 | 支持移除错题（标记掌握） | 删除接口执行后状态变为 MASTERED |
| R-EX-08 | 支持做题历史记录查询 | 可按时间范围筛选 records |
| R-EX-09 | 解析中可展示教师建议 | 存在建议时在解析中返回 suggestion |
| R-EX-10 | 所有数据仅允许本人访问 | 任何越权访问返回 403 |

## 5.4 学生端 AI 个性化出题（AIQ）

| 需求ID | 需求描述 | 验收标准 |
|---|---|---|
| R-AIQ-01 | 支持 AI 生成个性化题目 | `POST /student/ai-questions/generate` 返回题目数组 |
| R-AIQ-02 | 支持 count/subject/difficulty 参数 | 参数校验严格，非法参数返回 400 |
| R-AIQ-03 | 支持 AI 出题历史列表 | `GET /student/ai-questions` 返回分页列表 |
| R-AIQ-04 | 支持提交 AI 题目答案 | `POST /student/ai-questions/submit` 可批量提交 |
| R-AIQ-05 | 支持 AI 题目解析 | `GET /student/ai-questions/{recordId}/analysis` 返回分步解析 |
| R-AIQ-06 | 历史记录包含完成状态与正确率 | 返回 completed/correctRate/score |
| R-AIQ-07 | 出题依据学生错题、学习进度、教师建议 | 生成题应与薄弱点相关，且可解释生成依据 |
| R-AIQ-08 | AI 生成题需持久化并标记来源 | 题目 source = AI_GENERATED |

## 5.5 教师端（TCH）

| 需求ID | 需求描述 | 验收标准 |
|---|---|---|
| R-TCH-01 | 支持上传 PDF/Docx 到知识库 | 上传成功后产生 document 记录 |
| R-TCH-02 | 支持文档处理状态追踪 | 状态包含 UPLOADING/PARSING/EMBEDDING/READY/FAILED |
| R-TCH-03 | 上传后自动切分、向量化、入库 | Qdrant 可检索到对应文档 chunks |
| R-TCH-04 | 支持删除知识文档并级联向量 | 删除 document 后向量同步删除 |
| R-TCH-05 | 支持 AI 教案生成 | 输入 topic/grade/duration 返回结构化教案 |
| R-TCH-06 | 教案支持编辑、保存、删除、导出 | 导出格式支持 Markdown/PDF |
| R-TCH-07 | 支持查看学生学情分析 | 返回做题量、平均分、高频错点 |
| R-TCH-08 | 支持教师建议管理 | 可对学生错题写建议，学生端可见 |
| R-TCH-09 | 支持教案分享 | 可生成可访问的分享链接（受权限或时效控制） |

## 5.6 管理端（ADM）

| 需求ID | 需求描述 | 验收标准 |
|---|---|---|
| R-ADM-01 | 支持用户管理（查、新增、角色/状态更新） | 管理接口可完成用户生命周期管理 |
| R-ADM-02 | 支持查看关键操作信息 | 可查询用户关键行为审计记录 |
| R-ADM-03 | 支持教学资源管理与下载 | 可浏览教案/题库资源并下载 |
| R-ADM-04 | 支持平台数据可视化 | 看板展示用户数、AI 对话数、文档数、向量数 |

## 5.7 平台与技术（PLT）

| 需求ID | 需求描述 | 验收标准 |
|---|---|---|
| R-PLT-01 | 支持本地与云端部署 | 本地 docker-compose 可启动核心依赖；云端可通过 `.env` 切换 |
| R-PLT-02 | 采用现代技术栈 | 前端 Vue3+TS；后端 Spring Boot/Java；AI 服务 FastAPI/Python；PostgreSQL+Qdrant+Redis+MinIO |
| R-PLT-03 | 统一响应与错误语义 | API 返回结构一致，错误码可被前端稳定处理 |
| R-PLT-04 | 关键链路可观测 | 关键操作具备请求 ID、错误日志与基础指标 |

## 6. 非功能需求（MVP 级）

1. 关键接口（登录、问答、提交答案）可稳定响应，不出现系统性阻断。
2. AI 回答应尽量基于知识库引用，避免无依据输出。
3. 权限校验必须默认拒绝（deny-by-default）。
4. 任何涉及隐私/账户的字段不得在日志明文输出。

## 7. 验收定义（全局）

完整 DoD 与验收用例见 `11-验收清单与演示脚本.md`（验收唯一源）。

---
文档状态：`v1.1.0`（2026-02-26 验收引用 11）
