# EduNexus AI 前端实现规范与设计系统约束

## 1. 文档目标
将 `03-用户流程与页面交互` 转换为可直接编码的前端实现规范，减少“页面能看但不可维护”的情况。

## 2. 技术与架构基线

1. Vue 3.5 + TypeScript 5.8 + Vite 6。
2. 状态管理：Pinia（按领域拆分 store）。
3. 路由：Vue Router（路由元信息驱动权限与面包屑）。
4. 请求层：`services/*` 统一封装，组件内禁止直写 HTTP 调用。
5. UI 组件：Element Plus + 业务组件二次封装。

## 3. 目录约束（web）

```text
apps/web/src/
  app/
    router/
    guards/
    providers/
  pages/
    student/
    teacher/
    admin/
  components/
    common/
    business/
  services/
    api-client.ts
    auth.service.ts
    ...
  stores/
  schemas/
  styles/
```

## 4. 设计 Token 与主题约束

1. 颜色、间距、圆角、阴影必须由 CSS Variables 驱动。
2. 禁止在页面里硬编码品牌色值（临时 demo 除外）。
3. 文本层级：标题/正文/辅助文案须使用统一字号与行高 token。
4. 图表颜色需在明亮背景下保持 AA 对比度。

## 5. 组件交互约束

## 5.1 列表页

1. 必须实现：加载中、空态、错误态、就绪态。
2. 分页参数统一：`page`、`size`，与 `06` 保持一致。
3. 支持“保留上次成功数据 + 刷新中”状态，避免闪屏。

## 5.2 表单页

1. 提交前做前端 schema 校验（zod/yup 任一）。
2. 提交按钮在请求中禁用，防重复点击。
3. 后端 `400` 字段错误需要映射到具体表单项。

## 5.3 聊天页面

1. 消息列表滚动与自动定位行为可预测（新消息默认滚到底部）。
2. SSE 模式下需支持中断恢复与失败重试。
3. 引用区块需展示 `filename + score + snippet`。

## 6. 路由与权限实现

1. 路由元信息至少包含：`requiresAuth`、`roles[]`。
2. 鉴权失败重定向 `/login`；越权重定向 `/403`。
3. 访问受保护路由前应先拉取 `GET /auth/me`（缓存短期有效）。

## 7. 状态管理约束

1. 每个领域一个 store：`auth/chat/exercise/aiq/teacher/admin`。
2. store 只处理状态与动作，不直接依赖 UI 组件。
3. 跨页面共享筛选条件（错题、记录列表）需可序列化到 URL query。

## 8. 可访问性（a11y）

1. 关键可点击元素必须可通过键盘触发。
2. 图标按钮必须提供可访问名称（`aria-label`）。
3. 表单错误信息需可被屏幕阅读器读取。

## 9. 响应式规范

1. 断点：`mobile <= 767`，`tablet 768-1279`，`desktop >= 1280`。
2. 学生聊天页在 mobile 端允许会话列表抽屉化。
3. 管理后台表格在 mobile 端允许卡片化，但不得丢失关键操作。

## 10. 错误处理与可观测

1. 全局错误边界用于兜底渲染。
2. 统一错误提示文案映射 `code`（见 `10-开发约束` 错误码表）。
3. 前端日志至少记录 `traceId + route + action + latency`。

## 11. 前端测试基线

1. 单元测试：组件行为、store 动作、工具函数。
2. E2E：登录、聊天、做题提交、文档上传、管理查询。
3. 可视化回归（可选）：关键页面快照比较。

## 12. 与其它文档关系

1. 页面流程与业务动作：`03`。
2. API 字段与响应结构：`06`。
3. 权限与归属规则：`07`。
4. 质量门禁：`13`。

---
文档状态：`v1.0.0`（2026-02-26 新建）
